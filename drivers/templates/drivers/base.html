<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}MotoristaPower{% endblock title %}</title>
    <!-- Incluindo Tailwind CSS e Font Awesome -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Estilos básicos para o layout */
        body { font-family: ui-sans-serif, system-ui; background-color: #f3f4f6; }
        /* Barra lateral sempre fica à esquerda em desktop */
        .sidebar { min-width: 250px; background-color: #374151; color: white; transition: transform 0.3s ease-in-out; }
        .content { transition: margin-left 0.3s; }

        /* Configuração mobile: Esconde a sidebar por padrão no mobile */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                height: 100%;
                z-index: 50;
                transform: translateX(-250px); /* Escondido para a esquerda */
                box-shadow: 2px 0 5px rgba(0,0,0,0.5);
            }
            .sidebar.open {
                transform: translateX(0); /* Mostra a sidebar */
            }
            .content { margin-left: 0; }
            .mobile-toggle {
                display: block;
                position: fixed;
                top: 1rem;
                left: 1rem;
                z-index: 60;
                background-color: #374151;
                color: white;
                padding: 0.5rem;
                border-radius: 0.375rem;
                cursor: pointer;
            }
        }
    </style>
</head>
<body class="flex h-screen">

    <!-- Ícone Mobile para abrir menu -->
    <div id="mobile-toggle" class="mobile-toggle hidden md:hidden">
        <i class="fas fa-bars"></i>
    </div>

    <!-- BARRA LATERAL -->
    <!-- A classe flex md:flex garante que ela apareça em desktop e o JS lida com mobile -->
    <div id="sidebar" class="sidebar flex-col p-4 shadow-xl flex">
        <div class="text-2xl font-extrabold mb-8 text-yellow-400">
            MotoristaPower
        </div>

        <div class="flex-grow">
            <nav class="space-y-2">

                <!-- Dashboard -->
                <a href="{% url 'drivers:dashboard' %}" class="block p-2 rounded hover:bg-gray-600 {% if request.resolver_match.url_name == 'dashboard' or request.resolver_match.url_name == 'index' %}bg-gray-700{% endif %}">
                    <i class="fas fa-home mr-2"></i> Dashboard
                </a>

                <!-- Listar Motoristas (Visível para todos autenticados) -->
                <a href="{% url 'drivers:motorista_list' %}" class="block p-2 rounded hover:bg-gray-600 {% if request.resolver_match.url_name == 'motorista_list' %}bg-gray-700{% endif %}">
                    <i class="fas fa-users mr-2"></i> Motoristas
                </a>

                <!-- Cadastrar Motorista (Visível para todos, linka para o formulário) -->
                <a href="{% url 'drivers:motorista_create' %}" class="block p-2 rounded hover:bg-gray-600 {% if request.resolver_match.url_name == 'motorista_create' or request.resolver_match.url_name == 'motorista_update' %}bg-gray-700{% endif %}">
                    <i class="fas fa-user-plus mr-2"></i> Cadastro
                </a>

                <!-- Relatórios (Visível APENAS para Staff/Admin) -->
                {% if user.is_authenticated and user.is_staff %}
                <a href="{% url 'drivers:relatorios' %}" class="block p-2 rounded hover:bg-gray-600 {% if 'relatorio' in request.resolver_match.url_name %}bg-gray-700{% endif %}">
                    <i class="fas fa-chart-line mr-2"></i> Relatórios
                </a>
                {% endif %}

            </nav>
        </div>

        <!-- Informações do Usuário e Logout -->
        <!-- O bloco de login/logout é crucial e deve estar sempre visível se a sidebar estiver aberta -->
        <div class="mt-4 pt-4 border-t border-gray-600">
            {% if user.is_authenticated %}
                <p class="text-sm font-semibold mb-2">
                    Logado como:
                    <span class="text-yellow-400 font-bold">
                        {% if user.is_staff %}
                            (ADMIN) {{ user.username }}
                        {% else %}
                            (COMUM) {{ user.username }}
                        {% endif %}
                    </span>
                </p>
                <!-- ESTE É O BOTÃO DE SAIR -->
                <a id="logout-link" href="{% url 'logout' %}?next={% url 'login' %}" class="block p-2 rounded text-red-300 hover:bg-red-700 hover:text-white transition-colors">
                    <i class="fas fa-sign-out-alt mr-2"></i> Sair
                </a>
            {% else %}
                <p class="text-sm font-semibold mb-2">Você é um Visitante.</p>
                <a href="{% url 'login' %}" class="block p-2 rounded text-green-300 hover:bg-green-700 hover:text-white transition-colors">
                    <i class="fas fa-sign-in-alt mr-2"></i> Login
                </a>
            {% endif %}
        </div>
    </div>

    <!-- CONTEÚDO PRINCIPAL -->
    <div id="main-content" class="flex-1 overflow-y-auto p-4 md:p-8 content">

        <!-- Mensagens do Django (Success/Error/Warning) -->
        {% if messages %}
            <div class="mb-4">
                {% for message in messages %}
                    <div class="p-3 mb-2 rounded shadow
                        {% if message.tags == 'success' %}bg-green-100 border-l-4 border-green-500 text-green-700
                        {% elif message.tags == 'error' %}bg-red-100 border-l-4 border-red-500 text-red-700
                        {% elif message.tags == 'warning' %}bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700
                        {% else %}bg-blue-100 border-l-4 border-blue-500 text-blue-700
                        {% endif %}">
                        <i class="mr-2 fas
                        {% if message.tags == 'success' %}fa-check-circle
                        {% elif message.tags == 'error' %}fa-times-circle
                        {% elif message.tags == 'warning' %}fa-exclamation-triangle
                        {% else %}fa-info-circle
                        {% endif %}"></i>
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <!-- Bloco ONDE o conteúdo de cada view será inserido -->
        <div class="bg-white p-6 rounded-lg shadow-md">
            {% block content %}
                <!-- Conteúdo específico da página (dashboard, lista, etc.) entra aqui -->
            {% endblock content %}
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.getElementById('sidebar');
            const toggleButton = document.getElementById('mobile-toggle');

            // 1. Configurações Iniciais da Sidebar
            function initializeSidebar() {
                if (window.innerWidth >= 768) {
                    // Desktop: sempre visível
                    sidebar.classList.remove('hidden', 'open');
                    sidebar.classList.add('flex');
                    toggleButton.classList.add('hidden');
                } else {
                    // Mobile: esconde, mas mostra o toggle
                    sidebar.classList.remove('flex');
                    sidebar.classList.add('hidden');
                    toggleButton.classList.remove('hidden');
                }
            }

            // 2. Toggle para Mobile
            if (toggleButton) {
                toggleButton.addEventListener('click', function() {
                    sidebar.classList.toggle('open');
                });
            }

            // 3. Fechar sidebar ao clicar no link (mobile) ou fora
            const mainContent = document.getElementById('main-content');

            sidebar.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth < 768) {
                        sidebar.classList.remove('open');
                    }
                });
            });

            // Adiciona a funcionalidade de fechar a sidebar ao clicar fora dela
            mainContent.addEventListener('click', (e) => {
                // Se a tela for mobile, a sidebar estiver aberta, e o clique não foi na sidebar nem no botão de toggle
                if (window.innerWidth < 768 && sidebar.classList.contains('open') && !sidebar.contains(e.target) && e.target !== toggleButton) {
                    sidebar.classList.remove('open');
                }
            });

            // 4. Re-inicializar em redimensionamento
            window.addEventListener('resize', initializeSidebar);
            initializeSidebar();
        });
    </script>
</body>
</html>
