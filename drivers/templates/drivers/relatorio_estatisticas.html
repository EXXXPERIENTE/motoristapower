<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatórios - MotoristaPower</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .stat-card {
            transition: transform 0.3s;
            border: none;
            border-radius: 10px;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .btn-report {
            border-radius: 25px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s;
        }
        .btn-report:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand fw-bold" href="{% url 'drivers:dashboard' %}">
                <i class="bi bi-truck"></i>
                <span class="text-warning">Motorista</span>Power
            </a>
        </div>
    </nav>

    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white py-4">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h2 class="mb-0">
                                    <i class="bi bi-graph-up-arrow"></i> Relatórios e Estatísticas
                                </h2>
                                <small class="opacity-75">Gerado em: {{ data_geracao }}</small>
                            </div>
                            <div class="col-md-4 text-end">
                                <a href="{% url 'drivers:motorista_list' %}" class="btn btn-light">
                                    <i class="bi bi-arrow-left"></i> Voltar
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="card-body p-4">
                        <!-- Cards de Estatísticas -->
                        <div class="row mb-5">
                            <div class="col-md-3 mb-3">
                                <div class="card stat-card bg-primary text-white">
                                    <div class="card-body text-center">
                                        <i class="bi bi-people display-4"></i>
                                        <h3>{{ total_motoristas }}</h3>
                                        <p class="mb-0">Total Motoristas</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card stat-card bg-success text-white">
                                    <div class="card-body text-center">
                                        <i class="bi bi-check-circle display-4"></i>
                                        <h3>{{ motoristas_ativos }}</h3>
                                        <p class="mb-0">Ativos</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card stat-card bg-warning text-dark">
                                    <div class="card-body text-center">
                                        <i class="bi bi-pause-circle display-4"></i>
                                        <h3>{{ motoristas_inativos }}</h3>
                                        <p class="mb-0">Inativos</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card stat-card bg-info text-white">
                                    <div class="card-body text-center">
                                        <i class="bi bi-currency-dollar display-4"></i>
                                        <h3>R$ {{ total_salarios|floatformat:2 }}</h3>
                                        <p class="mb-0">Folha Total</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Botões de Download -->
                        <div class="row mb-5">
                            <div class="col-12">
                                <h4 class="mb-4 text-center">
                                    <i class="bi bi-download"></i> Exportar Relatórios
                                </h4>
                                <div class="row justify-content-center">
                                    <div class="col-md-3 mb-3">
                                        <a href="{% url 'drivers:relatorio_excel' %}" class="btn btn-success btn-report w-100">
                                            <i class="bi bi-file-earmark-excel"></i><br>
                                            Excel Completo
                                        </a>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <a href="{% url 'drivers:relatorio_pdf' %}" class="btn btn-danger btn-report w-100">
                                            <i class="bi bi-file-earmark-pdf"></i><br>
                                            PDF Resumido
                                        </a>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <a href="{% url 'drivers:relatorio_estatisticas_excel' %}" class="btn btn-info btn-report w-100">
                                            <i class="bi bi-graph-up"></i><br>
                                            Estatísticas Excel
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Gráficos de Distribuição -->
                        <div class="row">
                            <!-- Por Estado -->
                            <div class="col-md-6 mb-4">
                                <div class="card">
                                    <div class="card-header bg-secondary text-white">
                                        <h5 class="mb-0">
                                            <i class="bi bi-map"></i> Distribuição por Estado
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        {% if motoristas_por_estado %}
                                            <div class="table-responsive">
                                                <table class="table table-sm">
                                                    <thead>
                                                        <tr>
                                                            <th>Estado</th>
                                                            <th>Quantidade</th>
                                                            <th width="100">Percentual</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for estado in motoristas_por_estado %}
                                                        <tr>
                                                            <td>{{ estado.estado|default:"NÃO INFORMADO" }}</td>
                                                            <td>{{ estado.total }}</td>
                                                            <td>
                                                                <div class="progress" style="height: 20px;">
                                                                    <div class="progress-bar"
                                                                         style="width: {{ estado.total|divisibleby:total_motoristas|floatformat:2 }}%">
                                                                        {{ estado.total|divisibleby:total_motoristas|floatformat:1 }}%
                                                                    </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        {% else %}
                                            <p class="text-muted text-center">Nenhum dado disponível</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <!-- Por Categoria CNH -->
                            <div class="col-md-6 mb-4">
                                <div class="card">
                                    <div class="card-header bg-secondary text-white">
                                        <h5 class="mb-0">
                                            <i class="bi bi-card-checklist"></i> Categorias de CNH
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        {% if motoristas_por_categoria %}
                                            <div class="table-responsive">
                                                <table class="table table-sm">
                                                    <thead>
                                                        <tr>
                                                            <th>Categoria</th>
                                                            <th>Quantidade</th>
                                                            <th width="100">Percentual</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for categoria in motoristas_por_categoria %}
                                                        <tr>
                                                            <td>{{ categoria.cnh_categoria|default:"NÃO INFORMADA" }}</td>
                                                            <td>{{ categoria.total }}</td>
                                                            <td>
                                                                <div class="progress" style="height: 20px;">
                                                                    <div class="progress-bar bg-success"
                                                                         style="width: {{ categoria.total|divisibleby:total_motoristas|floatformat:2 }}%">
                                                                        {{ categoria.total|divisibleby:total_motoristas|floatformat:1 }}%
                                                                    </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        {% else %}
                                            <p class="text-muted text-center">Nenhum dado disponível</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>